<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no"/>
<title>Cozy Life ‚Äî Isometric</title>
<style>
  *{box-sizing:border-box} html,body{height:100%;margin:0}
  body{background:#0e141b;color:#e7ecf2;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;overflow:hidden}
  header,footer{position:fixed;left:0;right:0;background:#111826;display:flex;align-items:center;justify-content:space-between;padding:10px 12px;z-index:10}
  header{top:0;box-shadow:0 2px 12px rgba(0,0,0,.35)}
  footer{bottom:0;gap:8px;justify-content:center}
  .badge{background:#1a2330;padding:2px 8px;border-radius:999px;font-size:12px}
  #bars{position:fixed;left:10px;right:10px;top:56px;display:grid;grid-template-columns:1fr 1fr;gap:8px;z-index:9}
  .bar{display:flex;gap:8px;align-items:center}.bar label{width:80px;opacity:.85}
  .meter{flex:1;height:10px;background:#16202b;border-radius:999px;overflow:hidden}
  .meter span{display:block;height:100%;background:linear-gradient(90deg,#4fd1ff,#7cffb2)}
  #tabs{position:fixed;left:10px;right:10px;top:124px;display:flex;gap:8px;z-index:9;flex-wrap:wrap}
  #tabs button{padding:10px 12px;border:0;border-radius:12px;background:#17212c;color:#e7ecf2}
  #tabs button.active{outline:2px solid rgba(255,255,255,.15)}
  .panel{position:fixed;left:10px;right:10px;bottom:74px;background:#0f151d;border-radius:14px;padding:10px;display:none;z-index:9}
  .panel.active{display:block}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
  .list{display:grid;gap:8px}
  .card{display:flex;justify-content:space-between;align-items:center;background:#121a24;border-radius:12px;padding:10px 12px}
  .name{font-weight:700}.meta{opacity:.85;font-size:13px}
  #toast{position:fixed;left:50%;top:22%;transform:translateX(-50%);background:rgba(0,0,0,.6);padding:10px 14px;border-radius:10px;backdrop-filter:blur(8px);z-index:99}
  canvas{position:fixed;inset:0}
  #rooms{position:fixed;right:10px;top:86px;display:flex;gap:6px;z-index:9}
  #rooms button{padding:8px 10px;border:0;border-radius:10px;background:#1a2330;color:#e7ecf2;font-size:12px}
  #p-me label{display:flex;flex-direction:column;gap:6px;font-size:14px}
  #p-me input[type=range], #p-me select{width:100%;padding:8px;border:0;border-radius:10px;background:#17212c;color:#e7ecf2}
</style>
</head>
<body>
<header>
  <div>Cozy Life <span class="badge">2D Iso</span></div>
  <div><span id="clock">7:00 AM</span> ‚Ä¢ <span id="job">Unemployed</span> ‚Ä¢ $<span id="money">120</span></div>
</header>

<!-- needs -->
<div id="bars">
  <div class="bar"><label>Energy</label><div class="meter"><span id="bEnergy"></span></div></div>
  <div class="bar"><label>Hunger</label><div class="meter"><span id="bHunger"></span></div></div>
  <div class="bar"><label>Fun</label><div class="meter"><span id="bFun"></span></div></div>
  <div class="bar"><label>Clean</label><div class="meter"><span id="bClean"></span></div></div>
  <div class="bar"><label>Edu</label><div class="meter"><span id="bEdu"></span></div></div>
  <div class="bar"><label>Rep</label><div class="meter"><span id="bRep"></span></div></div>
</div>

<!-- quick room buttons -->
<div id="rooms">
  <button data-room="living">Living</button>
  <button data-room="kitchen">Kitchen</button>
  <button data-room="bathroom">Bathroom</button>
  <button data-room="bedroom">Bedroom</button>
</div>

<!-- tabs -->
<div id="tabs">
  <button data-tab="actions" class="active">Actions</button>
  <button data-tab="jobs">Jobs</button>
  <button data-tab="relationships">Relationships</button>
  <button data-tab="me">Me</button>
</div>

<!-- actions -->
<section id="p-actions" class="panel active">
  <div class="grid" id="acts">
    <button data-act="eat">Eat üç≤</button>
    <button data-act="sleep">Sleep üõèÔ∏è</button>
    <button data-act="shower">Shower üöø</button>
    <button data-act="tv">Watch TV üì∫</button>
    <button data-act="study">Study üìö</button>
    <button data-act="work">Work üíº</button>
    <button data-act="clean">Clean üßπ</button>
    <button data-act="save">Save üíæ</button>
  </div>
  <div class="meta">Tap the floor to walk. Tap **sofa/bed/shower/kitchen/TV** to auto-walk and do it.</div>
</section>

<!-- jobs -->
<section id="p-jobs" class="panel"><div id="jobsList" class="list"></div></section>

<!-- relationships -->
<section id="p-relationships" class="panel">
  <div id="npcList" class="list"></div>
  <div class="card" id="npcActions" style="display:none">
    <div id="npcName">‚Äî</div>
    <div style="display:flex;gap:8px">
      <button data-npc="chat">Chat üí¨</button>
      <button data-npc="compliment">Compliment üåü</button>
      <button data-npc="gift">Gift üéÅ ($25)</button>
      <button data-npc="date">Ask Out ‚ù§Ô∏è ($40)</button>
    </div>
  </div>
</section>

<!-- me -->
<section id="p-me" class="panel">
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
    <label>Skin tone
      <select id="skin">
        <option value="#2c1f16" selected>Deep brown</option>
        <option value="#3b2a1d">Warm brown</option>
        <option value="#5a3b2b">Brown</option>
        <option value="#7a543e">Tan</option>
        <option value="#a1765c">Light tan</option>
      </select>
    </label>
    <label>Hair style
      <select id="hairStyle">
        <option value="curls" selected>Curls</option>
        <option value="bun">Bun</option>
        <option value="braids">Braids</option>
        <option value="short">Short</option>
      </select>
    </label>
    <label>Hair color
      <select id="hairColor">
        <option value="#0c0b0c" selected>Black</option>
        <option value="#2b1d12">Dark brown</option>
        <option value="#4a2c1a">Brown</option>
        <option value="#2b2b2b">Gray</option>
      </select>
    </label>
    <label>Outfit
      <select id="outfit">
        <option value="casual" selected>Casual (sneakers)</option>
        <option value="work">Work (flats)</option>
        <option value="gym">Gym (sneakers)</option>
        <option value="night">Night Out (heels)</option>
        <option value="cozy">Cozy (boots)</option>
      </select>
    </label>
    <div style="grid-column:1 / span 2;display:flex;gap:8px;align-items:center">
      <span class="badge">Time</span><input id="time" type="range" min="0.5" max="6" step="0.5" value="2" style="width:160px"><span id="tLbl" class="badge">2 min/sec</span>
    </div>
  </div>
</section>

<div id="toast" hidden></div>
<canvas id="cv"></canvas>
<footer><button id="load">Load</button><button id="reset">Reset</button></footer>

<script>
(()=>{ // ===== ISO ENGINE =====
const $=id=>document.getElementById(id), $$=q=>Array.from(document.querySelectorAll(q));
const clamp=(n,a,b)=>Math.max(a,Math.min(b,n));
const R=window.devicePixelRatio||1;
const cv=$('cv'), cx=cv.getContext('2d');
function size(){cv.width=Math.floor(innerWidth*R); cv.height=Math.floor((innerHeight)*R); cv.style.width=innerWidth+'px'; cv.style.height=innerHeight+'px';}
addEventListener('resize',size,{passive:true}); size();

/* ===== GAME STATE ===== */
const S={t:7*60,speed:2,energy:70,hunger:30,fun:40,clean:60,edu:10,rep:10,money:120,job:null,room:'living',npcs:[],sel:null,lastNpcDay:-1};
const A={skin:'#2c1f16',hair:'#0c0b0c',hairStyle:'curls',outfit:'casual'};
const JOBS={barista:{name:'Barista',open:[6,14],pay:16,req:0},stripper:{name:'Performer',open:[19,2],pay:28,req:0,audition:true},lawyer:{name:'Lawyer',open:[9,19],pay:55,req:70},doctor:{name:'Doctor',open:[7,19],pay:60,req:85}};
const rand=n=>Math.floor(Math.random()*n);

/* ===== UI HOOKS ===== */
$('jobsList').innerHTML=Object.keys(JOBS).map(k=>{const j=JOBS[k];return `<div class="card" data-job="${k}"><div><div class="name">${j.name}</div><div class="meta">$${j.pay}/hr ‚Ä¢ ${fmtHours(j.open)} ‚Ä¢ ${j.req?('Edu '+j.req+'+'): 'No req'}</div></div><button>${k==='stripper'?'Audition':'Apply'}</button></div>`}).join('');
$('p-jobs').addEventListener('click',e=>{
  const c=e.target.closest('.card'); if(!c) return; const k=c.dataset.job, j=JOBS[k];
  if(k==='stripper'){ const score=(S.fun+S.clean+S.rep)/3+Math.random()*20; if(score<45) return toast('Audition didn‚Äôt stick'); S.job=k; }
  else { if(S.edu<j.req) return toast('Not qualified'); S.job=k; }
  $('job').textContent=JOBS[S.job].name; toast('Hired!');
});
$('tabs').addEventListener('click',e=>{const b=e.target.closest('button'); if(!b)return; $$('#tabs button').forEach(x=>x.classList.remove('active')); b.classList.add('active'); $$('.panel').forEach(p=>p.classList.remove('active')); $('p-'+b.dataset.tab).classList.add('active');});
$('rooms').addEventListener('click',e=>{const r=e.target.getAttribute('data-room'); if(!r)return; S.room=r;});
$('acts').addEventListener('click',e=>{const k=e.target.getAttribute('data-act'); if(!k)return; ({eat,sleep,shower,tv,study,work,clean,save})[k](); setBars();});
$('skin').onchange=e=>{A.skin=e.target.value;};
$('hairStyle').onchange=e=>{A.hairStyle=e.target.value;};
$('hairColor').onchange=e=>{A.hair=e.target.value;};
$('outfit').onchange=e=>{A.outfit=e.target.value;};
const tSlider=$('time'), tLbl=$('tLbl'); tSlider.value=S.speed; tLbl.textContent=S.speed+' min/sec';
tSlider.oninput=()=>{S.speed=parseFloat(tSlider.value); tLbl.textContent=S.speed+' min/sec';};
$('load').onclick=load; $('reset').onclick=()=>{localStorage.removeItem('cozy_iso'); location.reload();};

/* ===== ISO MAP ===== */
const TILE=48*R, HALF=TILE/2, ORG={x:cv.width/2, y:220*R}; // origin
const ROOMS={
  living:{w:9,h:7,floor:'#2a3341',walls:'#121a24',items:[
    {type:'sofa',x:4,y:5},{type:'tv',x:2,y:3},{type:'plant',x:7,y:4},{type:'rug',x:4,y:4}
  ]},
  kitchen:{w:9,h:7,floor:'#3a3b2a',walls:'#121a24',items:[
    {type:'counter',x:4,y:3},{type:'fridge',x:6,y:3},{type:'plant',x:2,y:5}
  ]},
  bathroom:{w:7,h:6,floor:'#2b3640',walls:'#121a24',items:[
    {type:'shower',x:5,y:3},{type:'sink',x:3,y:3},{type:'rug',x:3,y:4}
  ]},
  bedroom:{w:9,h:7,floor:'#2f2834',walls:'#121a24',items:[
    {type:'bed',x:5,y:4},{type:'dresser',x:2,y:3},{type:'plant',x:7,y:5},{type:'rug',x:5,y:5}
  ]}
};
const DOORS={living:[['kitchen',1,6],['bathroom',8,1]], kitchen:[['living',1,1],['bedroom',8,6]], bathroom:[['living',1,3]], bedroom:[['kitchen',1,3]]};

/* ===== PLAYER & NPCs ===== */
const P={x:4,y:5,px:4,py:5,tx:null,ty:null,flip:1};
const NPCS=[];
function spawnNpc(){ if(NPCS.length>=3) return; NPCS.push({name:randName(),x:2+rand(5),y:2+rand(3),rel:10+rand(15),vx:Math.random()<.5?-0.2:0.2}); renderNpcList(); }

/* ===== RENDER ===== */
function iso(x,y){return {x:ORG.x+(x-y)*HALF, y:ORG.y+(x+y)*HALF*0.5};}
function drawRoom(){
  const Rm=ROOMS[S.room];
  // floor tiles
  for(let y=0;y<Rm.h;y++){
    for(let x=0;x<Rm.w;x++){
      const p=iso(x,y);
      // tile wood/plank shading
      cx.fillStyle=Rm.floor; cx.beginPath();
      cx.moveTo(p.x, p.y);
      cx.lineTo(p.x+HALF, p.y+HALF*0.5);
      cx.lineTo(p.x, p.y+HALF);
      cx.lineTo(p.x-HALF, p.y+HALF*0.5);
      cx.closePath(); cx.fill();
    }
  }
  // walls (back)
  cx.fillStyle=Rm.walls;
  const back=iso(Rm.w-1,0); cx.fillRect(back.x-HALF, back.y-60*R, HALF*Rm.w*2, 60*R);
  const side=iso(0,0); cx.fillRect(side.x-HALF*Rm.h, side.y-60*R, HALF*Rm.h*2, 60*R);
  // window highlights
  cx.fillStyle='#1f2937aa'; cx.fillRect(back.x-120*R, back.y-56*R, 80*R, 38*R);
  cx.fillRect(side.x-160*R, side.y-56*R, 80*R, 38*R);
}
function drawItem(it){
  const p=iso(it.x,it.y);
  if(it.type==='rug'){ cx.fillStyle='#1d2330'; cx.beginPath(); cx.moveTo(p.x, p.y+HALF*0.3); cx.lineTo(p.x+HALF*0.9, p.y+HALF*0.75); cx.lineTo(p.x, p.y+HALF*1.2); cx.lineTo(p.x-HALF*0.9, p.y+HALF*0.75); cx.closePath(); cx.fill(); return;}
  // simple sprites
  cx.save(); cx.translate(p.x,p.y);
  if(it.type==='sofa'){ sofaSprite(); }
  if(it.type==='tv'){ tvSprite(); }
  if(it.type==='plant'){ plantSprite(); }
  if(it.type==='counter'){ counterSprite(); }
  if(it.type==='fridge'){ fridgeSprite(); }
  if(it.type==='shower'){ showerSprite(); }
  if(it.type==='sink'){ sinkSprite(); }
  if(it.type==='bed'){ bedSprite(); }
  if(it.type==='dresser'){ dresserSprite(); }
  cx.restore();
}
function sofaSprite(){ cx.fillStyle='#8a685a'; rectIso(0,0,1.6,0.8,0.6); }
function tvSprite(){ cx.fillStyle='#1d2129'; rectIso(-0.2,-0.2,1.2,0.2,1.0); cx.fillStyle='#0b0f14'; rectIso(0,0,1.2,0.1,0.6); }
function plantSprite(){ cx.fillStyle='#2a7a54'; rectIso(0,0,0.8,0.4,0.6); }
function counterSprite(){ cx.fillStyle='#59606a'; rectIso(0,0,2.6,0.6,0.8); }
function fridgeSprite(){ cx.fillStyle='#c8d0d8'; rectIso(0,0,0.9,0.7,1.2); }
function showerSprite(){ cx.fillStyle='#3b5a6a'; rectIso(0,0,1.0,0.8,1.2); }
function sinkSprite(){ cx.fillStyle='#8792a0'; rectIso(0,0,1.2,0.5,0.7); }
function bedSprite(){ cx.fillStyle='#7a89c2'; rectIso(0,0,1.8,1.0,0.5); }
function dresserSprite(){ cx.fillStyle='#734f38'; rectIso(0,0,1.0,0.6,1.0); }

function rectIso(x,y,w,h,ht){
  // draw an iso box centered on tile
  const s=TILE/48;
  const A=iso(x,y), B=iso(x+w,y), C=iso(x,y+h), D=iso(x+w,y+h);
  // top
  cx.beginPath(); cx.moveTo(A.x,A.y); cx.lineTo(B.x,B.y); cx.lineTo(D.x,D.y); cx.lineTo(C.x,C.y); cx.closePath(); cx.fill();
  // sides
  cx.fillStyle=tint(cx.fillStyle,-20);
  cx.beginPath(); cx.moveTo(B.x,B.y); cx.lineTo(B.x,B.y+ht*TILE*0.5*s); cx.lineTo(D.x,D.y+ht*TILE*0.5*s); cx.lineTo(D.x,D.y); cx.closePath(); cx.fill();
  cx.fillStyle=tint(cx.fillStyle,-15);
  cx.beginPath(); cx.moveTo(A.x,A.y); cx.lineTo(A.x,A.y+ht*TILE*0.5*s); cx.lineTo(C.x,C.y+ht*TILE*0.5*s); cx.lineTo(C.x,C.y); cx.closePath(); cx.fill();
}
function tint(hex,amt){ // accept css like '#223344' or 'rgb...' but we use hex here
  let c = cx.fillStyle; if(c[0]!=='#') return c;
  const n = parseInt(c.slice(1),16);
  let r=(n>>16)+amt, g=((n>>8)&255)+amt, b=(n&255)+amt;
  r=clamp(r,0,255); g=clamp(g,0,255); b=clamp(b,0,255);
  return '#'+((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1);
}

/* ===== CHARACTER SPRITE (face, hair, outfits) ===== */
function drawChar(x,y,flip=1,me=true,skin=A.skin,hair=A.hair,style=A.hairStyle,out=A.outfit){
  const p=iso(x,y), s=R;
  cx.save(); cx.translate(p.x, p.y); cx.scale(flip,1); // flip for facing
  // shoes/outfit colors
  const outfits={
    casual:{top:'#a86dff',bottom:'#242833',shoe:'#e7ecf2'},
    work:{top:'#2ec27e',bottom:'#1f2a22',shoe:'#f1f5f9'},
    gym:{top:'#4fd1ff',bottom:'#14202a',shoe:'#c8f7ff'},
    night:{top:'#ff6b9a',bottom:'#2a2e39',shoe:'#f5d36b'},
    cozy:{top:'#8ad7a0',bottom:'#314b3c',shoe:'#eaeaea'}
  };
  const o=outfits[out]||outfits.casual;

  // feet
  cx.fillStyle=o.shoe; ellipse(0, HALF*0.9, 16*s,10*s); ellipse(20*s, HALF*0.9, 16*s,10*s);
  // legs
  cx.fillStyle=o.bottom; roundRect(2*s, HALF*0.4, 16*s, 26*s, 8*s);
  roundRect(22*s, HALF*0.4, 16*s, 26*s, 8*s);
  // torso
  cx.fillStyle=o.top; roundRect(0, 0, 38*s, 44*s, 14*s);
  // arms
  roundRect(-10*s, 6*s, 12*s, 28*s, 6*s);
  roundRect(36*s, 6*s, 12*s, 28*s, 6*s);
  // head
  cx.fillStyle=skin; circle(19*s, -10*s, 16*s);
  // hair
  cx.fillStyle=hair;
  if(style==='bun'){ circle(19*s,-24*s, 10*s); roundRect(6*s,-16*s,26*s,10*s,6*s); }
  else if(style==='curls'){ for(let i=0;i<6;i++){ circle(6*s+i*6*s,-18*s+ (i%2?2:-2)*s, 5*s); } roundRect(6*s,-14*s,26*s,8*s,4*s); }
  else if(style==='braids'){ for(let i=0;i<5;i++){ roundRect(8*s+i*5*s,-14*s,3*s,14*s,2*s);} }
  else { roundRect(6*s,-14*s,26*s,10*s,6*s); }
  // face
  cx.fillStyle='#fff'; roundRect(10*s,-4*s, 8*s,4*s,2*s); roundRect(20*s,-4*s, 8*s,4*s,2*s);
  cx.fillStyle='#111'; roundRect(13*s,-3*s, 3*s,3*s,1*s); roundRect(23*s,-3*s, 3*s,3*s,1*s);
  cx.fillStyle='#b66'; roundRect(14*s,6*s, 10*s,3*s,2*s);
  cx.restore();
}
function circle(x,y,r){cx.beginPath();cx.arc(x,y,r,0,Math.PI*2);cx.fill();}
function ellipse(x,y,w,h){cx.beginPath(); for(let i=0;i<2;i++){ } cx.save();cx.translate(x,y);cx.scale(w/2,h/2);cx.beginPath();cx.arc(0,0,1,0,Math.PI*2);cx.restore();cx.fill();}
function roundRect(x,y,w,h,r){cx.beginPath();cx.moveTo(x+r,y);cx.arcTo(x+w,y,x+w,y+h,r);cx.arcTo(x+w,y+h,x,y+h,r);cx.arcTo(x,y+h,x,y,r);cx.arcTo(x,y,x+w,y,r);cx.closePath();cx.fill();}

/* ===== INPUT ===== */
cv.addEventListener('pointerdown',e=>{
  const rect=cv.getBoundingClientRect(); const mx=(e.clientX-rect.left)*R, my=(e.clientY-rect.top)*R;
  // find clicked tile by bruteforce search (grid is small)
  const Rm=ROOMS[S.room]; let best=null,dmin=1e9;
  for(let y=0;y<Rm.h;y++)for(let x=0;x<Rm.w;x++){
    const p=iso(x,y); const d=(p.x-mx)**2+(p.y-my)**2; if(d<dmin){dmin=d; best={x,y};}
  }
  if(best){ P.tx=best.x; P.ty=best.y; }
},{passive:true});

/* ===== LOOP ===== */
let last=performance.now();
function tick(now){
  const dt=Math.min(50,now-last)/1000; last=now;
  // time & needs decay
  S.t += S.speed*dt; const s=S.speed/2; S.hunger=clamp(S.hunger+0.25*s*dt,0,100); S.energy=clamp(S.energy-0.18*s*dt,0,100); S.clean=clamp(S.clean-0.10*s*dt,0,100); S.fun=clamp(S.fun-0.08*s*dt,0,100);
  const day=Math.floor(S.t/(24*60)); if(day!==S.lastNpcDay){S.lastNpcDay=day; spawnNpc();}
  // npc move
  NPCS.forEach(n=>{ n.x+=n.vx*dt; if(n.x<1||n.x>ROOMS[S.room].w-2) n.vx*=-1; });

  // move player
  if(P.tx!=null){
    const dx=P.tx-P.x, dy=P.ty-P.y, L=Math.hypot(dx,dy);
    if(L>0.02){ P.x+=dx*dt*1.8; P.y+=dy*dt*1.8; P.flip=dx<0?-1:1; }
    else { P.x=P.tx; P.y=P.ty; interactHere(); P.tx=P.ty=null; }
  }

  // draw
  cx.clearRect(0,0,cv.width,cv.height);
  drawRoom();
  ROOMS[S.room].items.forEach(drawItem);
  // doors
  (DOORS[S.room]||[]).forEach(([to,x,y])=>{
    const p=iso(x,y); cx.fillStyle='#0f172a'; roundRect(p.x-10*R,p.y+6*R,20*R,10*R,4*R);
  });
  // npcs then player (by y for depth)
  const sprites=[...NPCS.map(n=>({y:n.y,fn:()=>drawChar(n.x,n.y, n.vx<0?-1:1,false, '#c99b75','#333','short','work')})), {y:P.y,fn:()=>drawChar(P.x,P.y,P.flip,true)}];
  sprites.sort((a,b)=>a.y-b.y).forEach(s=>s.fn());

  setBars();
  requestAnimationFrame(tick);
}
requestAnimationFrame(tick);

/* ===== INTERACTIONS ===== */
function interactHere(){
  const it = ROOMS[S.room].items.find(i=>i.x===Math.round(P.x)&&i.y===Math.round(P.y));
  if(!it) return;
  if(it.type==='bed'){ sleep(); toast('You slept'); }
  if(it.type==='shower'){ shower(); toast('Shower done'); }
  if(it.type==='counter' || it.type==='fridge' || S.room==='kitchen'){ eat(); toast('Ate a meal'); }
  if(it.type==='tv' || it.type==='sofa'){ tv(); toast('Watched TV'); }
}

/* ===== ACTIONS ===== */
function eat(){ if(S.money<8) return toast('Need $8'); S.money-=8; S.hunger=clamp(S.hunger-35,0,100); S.energy=clamp(S.energy+5,0,100); timePass(20); }
function sleep(){ let m=0; while(S.energy<95&&m<8*60){ S.energy=clamp(S.energy+1.2,0,100); S.hunger=clamp(S.hunger+0.4,0,100); m+=10;} timePass(m); }
function shower(){ S.clean=clamp(S.clean+35,0,100); S.energy=clamp(S.energy+2,0,100); timePass(15); }
function tv(){ S.fun=clamp(S.fun+28,0,100); S.energy=clamp(S.energy-6,0,100); timePass(40); }
function study(){ if(S.energy<20) return toast('Too tired'); S.edu=clamp(S.edu+6+rand(4),0,100); S.energy=clamp(S.energy-10,0,100); S.fun=clamp(S.fun-4,0,100); timePass(50); }
function work(){
  if(!S.job) return toast('No job yet');
  const j=JOBS[S.job], h=hour(S.t), [o,c]=j.open, open=o<c?(h>=o&&h<c):(h>=o||h<c);
  if(!open) return toast('Job closed now');
  const hrs=2+rand(2), pay=j.pay*hrs + (S.job==='stripper'?rand(80):0);
  const perf=(S.energy>40?1:0.7)*(S.clean>40?1:0.8);
  S.money+=Math.floor(pay*perf);
  S.energy=clamp(S.energy-12*hrs/2,0,100); S.hunger=clamp(S.hunger+10*hrs/2,0,100); S.fun=clamp(S.fun+(S.job==='stripper'?4:-4),0,100); S.clean=clamp(S.clean-6*hrs/2,0,100);
  timePass(hrs*60); toast(`Worked ${hrs}h, earned $${Math.floor(pay*perf)}`);
}
function clean(){ S.clean=clamp(S.clean+28,0,100); S.energy=clamp(S.energy-5,0,100); timePass(30); }
function save(){ localStorage.setItem('cozy_iso',JSON.stringify({S,A})); toast('Saved'); }
function load(){ const raw=localStorage.getItem('cozy_iso'); if(!raw) return toast('No save'); try{ const d=JSON.parse(raw); Object.assign(S,d.S||{}); Object.assign(A,d.A||{}); setBars(); $('job').textContent=S.job?JOBS[S.job].name:'Unemployed'; $('skin').value=A.skin; $('hairStyle').value=A.hairStyle; $('hairColor').value=A.hair; $('outfit').value=A.outfit; toast('Loaded'); }catch{ toast('Load failed'); }}

/* ===== HELPERS ===== */
function setBars(){ $('bEnergy').style.width=S.energy+'%'; $('bHunger').style.width=(100-S.hunger)+'%'; $('bFun').style.width=S.fun+'%'; $('bClean').style.width=S.clean+'%'; $('bEdu').style.width=S.edu+'%'; $('bRep').style.width=S.rep+'%'; $('money').textContent=Math.floor(S.money); $('clock').textContent=timeFmt(S.t); $('job').textContent=S.job?JOBS[S.job].name:'Unemployed'; }
function timePass(m){ S.t+=m; }
function hour(t){return Math.floor((t/60)%24);}
function timeFmt(m){const h=hour(m),mi=Math.floor(m%60),ap=h>=12?'PM':'AM',hh=((h+11)%12+1);return `${hh}:${String(mi).padStart(2,'0')} ${ap}`;}
function fmtHours([o,c]){ const f=h=>h===0?'12a':(h<12?`${h}a`:(h===12?'12p':`${h-12}p`)); return `${f(o)}‚Äì${f(c)}` }
function randName(){const a=['Alex','Jordan','Taylor','Riley','Casey','Avery','Kai','Skye','Nina','Malik','Jada','Imani','Noah']; return a[rand(a.length)]+' '+(Math.random()<0.5?'B.':'C.');}
function toast(msg,ms=1200){const t=$('toast'); t.textContent=msg; t.hidden=false; clearTimeout(toast._h); toast._h=setTimeout(()=>t.hidden=true,ms);}

/* ===== NPC UI ===== */
function renderNpcList(){
  $('npcList').innerHTML=S.npcs.map(n=>`<div class="card" data-id="${n.id}"><div><div class="name">${n.name}</div><div class="meta">acquaintance</div></div><div class="meta">Rel ${n.rel}</div></div>`).join('');
  $$('#npcList .card').forEach(el=>el.addEventListener('click',()=>{ const n=S.npcs.find(x=>x.id===el.dataset.id); S.sel=n; $('npcActions').style.display='flex'; $('npcName').textContent=`${n.name} ‚Ä¢ Rel ${n.rel}`; }));
}
$('p-relationships').addEventListener('click',e=>{
  const k=e.target.getAttribute('data-npc'); if(!k) return; const n=S.sel; if(!n) return toast('Pick someone first');
  if(k==='chat'){ S.fun=clamp(S.fun+8,0,100); n.rel+=5+rand(5); timePass(20); toast('Chatted'); }
  if(k==='compliment'){ const g=Math.random()<.8?(6+rand(6)):0; n.rel+=g; timePass(10); toast(g?'They smiled':'Awkward‚Ä¶'); }
  if(k==='gift'){ if(S.money<25) return toast('Need $25'); S.money-=25; n.rel+=10+rand(10); timePass(10); toast('They loved it'); }
  if(k==='date'){ if(S.money<40) return toast('Need $40'); S.money-=40; S.fun=clamp(S.fun+18,0,100); S.clean=clamp(S.clean-6,0,100); S.energy=clamp(S.energy-8,0,100); n.rel+=12+rand(10); timePass(120); toast('Cute date ‚ù§Ô∏è'); }
  renderNpcList(); setBars();
});

/* boot */
S.npcs=[{id:cryptoRandom(),name:randName(),rel:12},{id:cryptoRandom(),name:randName(),rel:20}]; renderNpcList(); requestAnimationFrame(tick);

/* utils */
function cryptoRandom(){return Math.random().toString(36).slice(2);}
})(); 
</script>
</body>
</html>
